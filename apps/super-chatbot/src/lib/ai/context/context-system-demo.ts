/**
 * –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
 * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–µ–¥–∏–∞
 */

import {
  analyzeImageContext,
  analyzeVideoContext,
  analyzeAudioContext,
  analyzeMediaContext,
  contextManager,
} from './index';

// –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
export async function demonstrateContextSystem() {
  console.log('üéØ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞');
  console.log('='.repeat(50));

  const chatId = 'demo-chat-123';
  const currentAttachments = [
    {
      url: 'https://example.com/current-image.jpg',
      contentType: 'image/jpeg',
      name: 'Current Image',
    },
  ];

  // 1. –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  console.log('\nüñºÔ∏è –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:');
  const imageContext = await analyzeImageContext(
    '–∏–∑–º–µ–Ω–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —Å–¥–µ–ª–∞–π –≥–ª–∞–∑–∞ –≥–æ–ª—É–±—ã–º–∏',
    chatId,
    currentAttachments,
  );
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', imageContext);

  // 2. –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤–∏–¥–µ–æ
  console.log('\nüé¨ –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤–∏–¥–µ–æ:');
  const videoContext = await analyzeVideoContext(
    '–¥–æ–±–∞–≤—å –º—É–∑—ã–∫—É –∫ —ç—Ç–æ–º—É —Ä–æ–ª–∏–∫—É',
    chatId,
    currentAttachments,
  );
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', videoContext);

  // 2.1. –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è image-to-video
  console.log('\nüé¨üñºÔ∏è –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è image-to-video:');
  const imageToVideoContext = await analyzeVideoContext(
    '—Å–¥–µ–ª–∞–π –≤–∏–¥–µ–æ –∏–∑ —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
    chatId,
    currentAttachments,
  );
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', imageToVideoContext);

  // 2.2. –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  console.log('\nüé¨‚ú® –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:');
  const animateContext = await analyzeVideoContext(
    '–æ–∂–∏–≤–∏ —ç—Ç—É –∫–∞—Ä—Ç–∏–Ω–∫—É',
    chatId,
    currentAttachments,
  );
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', animateContext);

  // 3. –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∞—É–¥–∏–æ
  console.log('\nüéµ –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∞—É–¥–∏–æ:');
  const audioContext = await analyzeAudioContext(
    '–æ–∑–≤—É—á—å —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç',
    chatId,
    currentAttachments,
  );
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', audioContext);

  // 4. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
  console.log('\nüîß –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è:');
  const universalContext = await analyzeMediaContext(
    'image',
    '–ø–æ–¥–ø—Ä–∞–≤—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
    chatId,
    currentAttachments,
  );
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', universalContext);

  // 5. –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
  console.log('\n‚öôÔ∏è –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞:');
  const chatMedia = await contextManager.getChatMedia(chatId);
  console.log('–ú–µ–¥–∏–∞ –∏–∑ —á–∞—Ç–∞:', chatMedia.length, '—Ñ–∞–π–ª–æ–≤');

  const directContext = await contextManager.analyzeContext(
    'video',
    '–æ–±—Ä–µ–∂—å —ç—Ç–æ –≤–∏–¥–µ–æ',
    chatMedia,
    currentAttachments,
  );
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', directContext);

  console.log('\n‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
}

// –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
export const contextExamples = {
  // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  image: {
    '–∏–∑–º–µ–Ω–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ': '–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
    '—Å–¥–µ–ª–∞–π –≥–ª–∞–∑–∞ –≥–æ–ª—É–±—ã–º–∏': '–≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
    '–ø–æ–¥–ø—Ä–∞–≤—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Ñ–æ—Ç–æ': '–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
    '–∏–∑–º–µ–Ω–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É': '–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
    '–Ω–∞ —ç—Ç–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏': '–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞',
  },

  // –í–∏–¥–µ–æ
  video: {
    '–¥–æ–±–∞–≤—å –º—É–∑—ã–∫—É –∫ —ç—Ç–æ–º—É —Ä–æ–ª–∏–∫—É': '–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ',
    '–æ–±—Ä–µ–∂—å –≤–∏–¥–µ–æ': '–≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
    '–ø–æ–¥–ø—Ä–∞–≤—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–ª–∏–ø': '–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤–∏–¥–µ–æ',
    '–∏–∑–º–µ–Ω–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ': '–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ',
    '–≤ —ç—Ç–æ–º —Ä–æ–ª–∏–∫–µ': '–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞',
  },

  // Image-to-Video
  imageToVideo: {
    '—Å–¥–µ–ª–∞–π –≤–∏–¥–µ–æ –∏–∑ —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è': '–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
    '–æ–∂–∏–≤–∏ —ç—Ç—É –∫–∞—Ä—Ç–∏–Ω–∫—É': '–ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
    '–∞–Ω–∏–º–∏—Ä—É–π —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ': '–ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
    '—Å–æ–∑–¥–∞–π —Ä–æ–ª–∏–∫ –∏–∑ —ç—Ç–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏': '–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
    '—ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –≤–∏–¥–µ–æ': '–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –≤–∏–¥–µ–æ',
    'make video from this image': '–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∞–Ω–≥–ª.)',
    'animate this picture': '–ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∞–Ω–≥–ª.)',
    'bring this image to life': '–û–∂–∏–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∞–Ω–≥–ª.)',
  },

  // –ê—É–¥–∏–æ
  audio: {
    '–æ–∑–≤—É—á—å —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç': '–≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ - –æ–∑–≤—É—á–∫–∞',
    '–¥–æ–±–∞–≤—å –º—É–∑—ã–∫—É': '–≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ - –º—É–∑—ã–∫–∞',
    '–∏–∑–º–µ–Ω–∏ —ç—Ç–æ—Ç –∑–≤—É–∫': '–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–∫—É—â–µ–µ –∞—É–¥–∏–æ',
    '–ø–æ–¥–ø—Ä–∞–≤—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç—Ä–µ–∫': '–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∞—É–¥–∏–æ',
    '–≤ —ç—Ç–æ–π –º—É–∑—ã–∫–µ': '–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞',
  },
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
export async function testContextScenarios() {
  console.log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤');
  console.log('='.repeat(50));

  const chatId = 'test-chat-456';

  for (const [mediaType, scenarios] of Object.entries(contextExamples)) {
    console.log(`\nüì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ${mediaType}:`);

    for (const [message, description] of Object.entries(scenarios)) {
      console.log(`\n  üí¨ "${message}"`);
      console.log(`     –û–∂–∏–¥–∞–Ω–∏–µ: ${description}`);

      try {
        const context = await analyzeMediaContext(
          mediaType as 'image' | 'video' | 'audio',
          message,
          chatId,
        );

        console.log(`     –†–µ–∑—É–ª—å—Ç–∞—Ç: ${context.confidence} —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å`);
        console.log(`     –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: ${context.reasoning}`);
        if (context.sourceUrl) {
          console.log(`     URL: ${context.sourceUrl}`);
        }
      } catch (error) {
        console.log(`     –û—à–∏–±–∫–∞: ${error}`);
      }
    }
  }

  console.log('\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');
}

// –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö
const contextSystemDemo = {
  demonstrateContextSystem,
  testContextScenarios,
  contextExamples,
};

export default contextSystemDemo;
