# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –º–µ–¥–∏–∞-—Ñ–∞–π–ª–æ–≤

## –û–±–∑–æ—Ä

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ - —ç—Ç–æ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–∞—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –º–µ–¥–∏–∞-—Ñ–∞–π–ª–æ–≤ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ, –∞—É–¥–∏–æ) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
src/lib/ai/context/
‚îú‚îÄ‚îÄ universal-context.ts          # –ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –∏ –º–µ–Ω–µ–¥–∂–µ—Ä
‚îú‚îÄ‚îÄ image-context-analyzer.ts     # –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îú‚îÄ‚îÄ video-context-analyzer.ts     # –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è –≤–∏–¥–µ–æ
‚îú‚îÄ‚îÄ audio-context-analyzer.ts     # –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è –∞—É–¥–∏–æ
‚îî‚îÄ‚îÄ index.ts                      # –≠–∫—Å–ø–æ—Ä—Ç—ã –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```

### –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

#### `MediaContext`

```typescript
interface MediaContext {
  sourceUrl?: string; // URL –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –º–µ–¥–∏–∞
  sourceId?: string; // ID –º–µ–¥–∏–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
  mediaType: MediaType; // –¢–∏–ø –º–µ–¥–∏–∞ (image/video/audio)
  confidence: ConfidenceLevel; // –£—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (high/medium/low)
  reasoning: string; // –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞
  metadata?: Record<string, any>; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
}
```

#### `ChatMedia`

```typescript
interface ChatMedia {
  url: string; // URL –º–µ–¥–∏–∞-—Ñ–∞–π–ª–∞
  id?: string; // ID —Ñ–∞–π–ª–∞
  role: "user" | "assistant"; // –†–æ–ª—å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  timestamp: Date; // –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
  prompt?: string; // –û–ø–∏—Å–∞–Ω–∏–µ/–ø—Ä–æ–º–ø—Ç
  messageIndex: number; // –ò–Ω–¥–µ–∫—Å —Å–æ–æ–±—â–µ–Ω–∏—è
  mediaType: MediaType; // –¢–∏–ø –º–µ–¥–∏–∞
  metadata?: Record<string, any>; // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
}
```

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### 1. –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è** - –ø–æ–∏—Å–∫ –º–µ–¥–∏–∞ –≤–æ –≤–ª–æ–∂–µ–Ω–∏—è—Ö
2. **–ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ–¥–∏–∞-—Ñ–∞–π–ª–æ–≤
3. **–ü–∞—Ç—Ç–µ—Ä–Ω-–º–∞—Ç—á–∏–Ω–≥** - –ø–æ–∏—Å–∫ —è–≤–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –º–µ–¥–∏–∞
4. **–≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. **Fallback** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–µ–¥–∏–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 2. –£—Ä–æ–≤–Ω–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

- **High** - –º–µ–¥–∏–∞ –Ω–∞–π–¥–µ–Ω–æ –≤ —Ç–µ–∫—É—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –∏–ª–∏ —è–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞
- **Medium** - –Ω–∞–π–¥–µ–Ω–æ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –∏–ª–∏ —ç–≤—Ä–∏—Å—Ç–∏–∫–∞–º
- **Low** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ –º–µ–¥–∏–∞ –∫–∞–∫ fallback

### 3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

#### –†—É—Å—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- "—ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", "—ç—Ç–æ—Ç —Ä–æ–ª–∏–∫", "—ç—Ç–∞ –º—É–∑—ã–∫–∞"
- "—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ", "–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –∞—É–¥–∏–æ"
- "–ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", "–ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–æ–ª–∏–∫"
- "–ø–µ—Ä–≤–æ–µ –≤–∏–¥–µ–æ", "–≤—Ç–æ—Ä–æ–π —Ç—Ä–µ–∫"
- "–∏–∑–º–µ–Ω–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", "–ø–æ–¥–ø—Ä–∞–≤—å —ç—Ç–æ—Ç —Ä–æ–ª–∏–∫"

#### Image-to-Video –ø–∞—Ç—Ç–µ—Ä–Ω—ã (—Ä—É—Å—Å–∫–∏–µ)

- "—Å–¥–µ–ª–∞–π –≤–∏–¥–µ–æ –∏–∑ —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
- "–æ–∂–∏–≤–∏ —ç—Ç—É –∫–∞—Ä—Ç–∏–Ω–∫—É", "–∞–Ω–∏–º–∏—Ä—É–π —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
- "—Å–æ–∑–¥–∞–π —Ä–æ–ª–∏–∫ –∏–∑ —ç—Ç–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏"
- "—ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –≤–∏–¥–µ–æ"

#### –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- "this image", "that video", "this audio"
- "generated video", "uploaded audio"
- "last image", "previous video"
- "first audio", "second clip"
- "change this image", "fix this video"

#### Image-to-Video –ø–∞—Ç—Ç–µ—Ä–Ω—ã (–∞–Ω–≥–ª–∏–π—Å–∫–∏–µ)

- "make video from this image"
- "animate this picture", "bring this image to life"
- "create clip from this image"
- "this image as video"

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
import {
  analyzeImageContext,
  analyzeVideoContext,
  analyzeAudioContext,
} from "@/lib/ai/context";

// –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const imageContext = await analyzeImageContext(
  "–∏–∑–º–µ–Ω–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
  "chat-123",
  currentAttachments
);

// –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤–∏–¥–µ–æ
const videoContext = await analyzeVideoContext(
  "–ø–æ–¥–ø—Ä–∞–≤—å —ç—Ç–æ—Ç —Ä–æ–ª–∏–∫",
  "chat-123",
  currentAttachments
);

// –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∞—É–¥–∏–æ
const audioContext = await analyzeAudioContext(
  "–¥–æ–±–∞–≤—å –º—É–∑—ã–∫—É –∫ —ç—Ç–æ–º—É –∞—É–¥–∏–æ",
  "chat-123",
  currentAttachments
);
```

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

```typescript
import { analyzeMediaContext } from "@/lib/ai/context";

const context = await analyzeMediaContext(
  "image", // –∏–ª–∏ "video", "audio"
  "–∏–∑–º–µ–Ω–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
  "chat-123",
  currentAttachments
);
```

### –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞

```typescript
import { contextManager } from "@/lib/ai/context";

// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ–¥–∏–∞ –∏–∑ —á–∞—Ç–∞
const chatMedia = await contextManager.getChatMedia("chat-123");

// –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
const context = await contextManager.analyzeContext(
  "image",
  "–∏–∑–º–µ–Ω–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
  chatMedia,
  currentAttachments
);
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å AI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

- `configureImageGeneration` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `configureVideoGeneration` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
- `configureAudioGeneration` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ

### –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```typescript
const tool = configureImageGeneration({
  createDocument: createDocumentFunction,
  session: userSession,
  chatId: "chat-123", // ID —á–∞—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
  userMessage: "–∏–∑–º–µ–Ω–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", // –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  currentAttachments: attachments, // –í–ª–æ–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  defaultSourceImageUrl: "legacy-url", // Legacy –ø–æ–¥–¥–µ—Ä–∂–∫–∞
});
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –º–µ–¥–∏–∞

1. **–°–æ–∑–¥–∞—Ç—å –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä**:

```typescript
export class DocumentContextAnalyzer extends BaseContextAnalyzer {
  mediaType: MediaType = "document";

  getReferencePatterns(): ReferencePattern[] {
    return [
      // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    ];
  }

  // –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
}
```

2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä**:

```typescript
import { contextManager } from "@/lib/ai/context";
import { DocumentContextAnalyzer } from "./document-context-analyzer";

contextManager.registerAnalyzer(new DocumentContextAnalyzer());
```

3. **–î–æ–±–∞–≤–∏—Ç—å –≤ —ç–∫—Å–ø–æ—Ä—Ç—ã**:

```typescript
// –í index.ts
export { DocumentContextAnalyzer } from "./document-context-analyzer";
```

### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

–ö–∞–∂–¥—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å–≤–æ–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:

```typescript
getReferencePatterns(): ReferencePattern[] {
  return [
    {
      pattern: /(—ç—Ç–æ—Ç|—ç—Ç–∞)\s+(–¥–æ–∫—É–º–µ–Ω—Ç|—Ñ–∞–π–ª)/,
      weight: 0.9,
      description: "–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç",
      targetResolver: (message, media) => media[media.length - 1] || null,
    },
    // –î—Ä—É–≥–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã...
  ];
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### 1. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**

- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –º–µ–¥–∏–∞
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

### 2. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**

- –ï–¥–∏–Ω—ã–π API –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –º–µ–¥–∏–∞
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

### 3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤

### 4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**

- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –ú–æ–∫–∏—Ä—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### 5. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**

- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º—ã

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å–æ —Å—Ç–∞—Ä–æ–π:

- Legacy –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`defaultSourceImageUrl`) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
- –°—Ç–∞—Ä—ã–µ API –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–∞

### –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

1. **–§–∞–∑–∞ 1** - –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ)
2. **–§–∞–∑–∞ 2** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
3. **–§–∞–∑–∞ 3** - –£–¥–∞–ª–µ–Ω–∏–µ legacy –∫–æ–¥–∞
4. **–§–∞–∑–∞ 4** - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "—Å–¥–µ–ª–∞–π –≥–ª–∞–∑–∞ –≥–æ–ª—É–±—ã–º–∏"
const context = await analyzeImageContext("—Å–¥–µ–ª–∞–π –≥–ª–∞–∑–∞ –≥–æ–ª—É–±—ã–º–∏", "chat-123");

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// {
//   sourceUrl: "https://example.com/last-image.jpg",
//   confidence: "medium",
//   reasoning: "–∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
// }
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ

```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–¥–æ–±–∞–≤—å –º—É–∑—ã–∫—É –∫ —ç—Ç–æ–º—É —Ä–æ–ª–∏–∫—É"
const context = await analyzeVideoContext(
  "–¥–æ–±–∞–≤—å –º—É–∑—ã–∫—É –∫ —ç—Ç–æ–º—É —Ä–æ–ª–∏–∫—É",
  "chat-123"
);

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// {
//   sourceUrl: "https://example.com/video.mp4",
//   confidence: "high",
//   reasoning: "–ù–∞–π–¥–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ: –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º: /(—ç—Ç–æ|—ç—Ç–æ—Ç)\\s+(–≤–∏–¥–µ–æ|—Ä–æ–ª–∏–∫|—Ñ–∏–ª—å–º|–∫–ª–∏–ø)/"
// }
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2.1: Image-to-Video –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "—Å–¥–µ–ª–∞–π –≤–∏–¥–µ–æ –∏–∑ —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
const context = await analyzeVideoContext(
  "—Å–¥–µ–ª–∞–π –≤–∏–¥–µ–æ –∏–∑ —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è",
  "chat-123"
);

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// {
//   sourceUrl: "https://example.com/image.jpg",
//   confidence: "high",
//   reasoning: "–ù–∞–π–¥–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–µ–æ: –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º: /(—Å–¥–µ–ª–∞–π|—Å–æ–∑–¥–∞–π|—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π)\\s+(–≤–∏–¥–µ–æ|—Ä–æ–ª–∏–∫|—Ñ–∏–ª—å–º|–∫–ª–∏–ø)\\s+(–∏–∑|–Ω–∞\\s+–æ—Å–Ω–æ–≤–µ|–ø–æ)\\s+(—ç—Ç–æ–≥–æ|—ç—Ç–æ–≥–æ\\s+–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è|—ç—Ç–æ–π\\s+–∫–∞—Ä—Ç–∏–Ω–∫–∏)/"
// }
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2.2: –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–æ–∂–∏–≤–∏ —ç—Ç—É –∫–∞—Ä—Ç–∏–Ω–∫—É"
const context = await analyzeVideoContext("–æ–∂–∏–≤–∏ —ç—Ç—É –∫–∞—Ä—Ç–∏–Ω–∫—É", "chat-123");

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// {
//   sourceUrl: "https://example.com/picture.png",
//   confidence: "high",
//   reasoning: "–ù–∞–π–¥–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏: –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º: /(–æ–∂–∏–≤–∏|–∞–Ω–∏–º–∏—Ä—É–π|—Å–¥–µ–ª–∞–π\\s+–¥–≤–∏–∂—É—â–∏–º—Å—è)\\s+(—ç—Ç–æ|—ç—Ç–æ\\s+–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ|—ç—Ç—É\\s+–∫–∞—Ä—Ç–∏–Ω–∫—É)/"
// }
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ

```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–æ–∑–≤—É—á—å —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç"
const context = await analyzeAudioContext("–æ–∑–≤—É—á—å —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç", "chat-123");

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// {
//   sourceUrl: undefined,
//   confidence: "low",
//   reasoning: "–í –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ audio —Ñ–∞–π–ª–æ–≤"
// }
```

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**

- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `configureImageGeneration`
- **–í–∏–¥–µ–æ** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `configureVideoGeneration`
  - ‚úÖ **Video-to-Video** - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–µ–æ
  - ‚úÖ **Image-to-Video** - —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  - ‚úÖ **Text-to-Video** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞
- **–ê—É–¥–∏–æ** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `configureAudioGeneration`
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** - –≤—Å–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** - –≤—Å–µ —Ç–∏–ø—ã –º–µ–¥–∏–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ `media-settings-factory.ts`
- **–¢–∏–ø—ã** - –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### üéØ **–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**

```typescript
// –í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —É–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
import {
  configureImageGeneration,
  configureVideoGeneration,
  configureAudioGeneration,
} from "@/lib/ai/tools";

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
const imageTool = configureImageGeneration({
  createDocument: createDocumentFunction,
  session: userSession,
  chatId: "chat-123", // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
  userMessage: "–∏–∑–º–µ–Ω–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
  currentAttachments: attachments, // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
});

const videoTool = configureVideoGeneration({
  createDocument: createDocumentFunction,
  session: userSession,
  chatId: "chat-123", // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
  userMessage: "–¥–æ–±–∞–≤—å –º—É–∑—ã–∫—É –∫ —ç—Ç–æ–º—É —Ä–æ–ª–∏–∫—É", // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
  currentAttachments: attachments, // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
});

const audioTool = configureAudioGeneration({
  createDocument: createDocumentFunction,
  session: userSession,
  chatId: "chat-123", // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
  userMessage: "–æ–∑–≤—É—á—å —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç", // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
  currentAttachments: attachments, // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
});
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥** –∫ –∞–Ω–∞–ª–∏–∑—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –º–µ–¥–∏–∞
- **–í—ã—Å–æ–∫—É—é —Ç–æ—á–Ω–æ—Å—Ç—å** –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–õ–µ–≥–∫—É—é —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **–û–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- **–ü–æ–ª–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** —Å–æ –≤—Å–µ–º–∏ AI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ —É–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤–æ –≤—Å–µ AI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–∞! üéâ
