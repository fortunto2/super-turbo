# Режим редактирования изображений в артефактах

## Обзор

Добавлен режим редактирования для изображений в артефактах чат-бота. Теперь каждое изображение можно редактировать прямо в интерфейсе.

## Что добавлено

### 1. Кнопка "Редактировать" в артефакте

- Добавлена в панель действий изображения
- Активна только для завершенных изображений
- Переключает артефакт в режим редактирования

### 2. Компонент режима редактирования

- Полноэкранный интерфейс редактирования
- Выбор режима: "Базовое редактирование" или "Расширенное редактирование"
- Кнопки "Сохранить" и "Отмена"

### 3. Чистый холст для вашей логики

- Область с пунктирной границей для вашего функционала
- Доступ ко всем необходимым данным
- Готовые колбэки для сохранения и отмены

## Структура компонента

### Props компонента ImageDisplay

```typescript
{
  imageUrl: string;           // URL изображения для редактирования
  prompt: string;             // Промпт, по которому было создано изображение
  documentId: string;         // ID документа артефакта
  chatId: string;            // ID чата
  isEditing: boolean;        // Флаг режима редактирования
  editMode: string | null;   // Выбранный режим редактирования
  onEditToggle: () => void;  // Переключение режима редактирования
  onEditModeChange: (mode: string | null) => void; // Смена режима
  onSaveEdit: (editedImageUrl: string) => void;    // Сохранение изменений
  onCancelEdit: () => void;  // Отмена редактирования
}
```

### Доступные данные в режиме редактирования

- **URL изображения** - для загрузки в ваш редактор
- **Промпт** - для понимания контекста
- **Document ID** - для сохранения изменений
- **Chat ID** - для интеграции с чатом
- **Режим редактирования** - для выбора типа инструментов

## Как добавить свою логику

### 1. Замените область "ЧИСТЫЙ ХОЛСТ"

Найдите в коде:

```tsx
{
  /* ЧИСТЫЙ ХОЛСТ ДЛЯ ВАШЕЙ ЛОГИКИ РЕДАКТИРОВАНИЯ */
}
<div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center bg-gray-50">
  {/* Ваш код здесь */}
</div>;
```

### 2. Используйте доступные колбэки

- `onSaveEdit(editedImageUrl)` - для сохранения результата
- `onCancelEdit()` - для отмены изменений
- `onEditModeChange(mode)` - для смены режима

### 3. Интегрируйтесь с существующей системой

- Используйте `documentId` для сохранения в базу данных
- Используйте `chatId` для отправки в чат
- Обновите `parsedContent` через `updateContent`

## Пример интеграции

```tsx
// В области редактирования добавьте:
const handleImageEdit = async (editedImage: File) => {
  // 1. Загрузите отредактированное изображение
  const formData = new FormData();
  formData.append("file", editedImage);

  const response = await fetch("/api/files/upload", {
    method: "POST",
    body: formData,
  });

  const { url: editedImageUrl } = await response.json();

  // 2. Сохраните через колбэк
  onSaveEdit(editedImageUrl);
};

// 3. Добавьте UI для редактирования
<div className="your-editor-component">
  {/* Ваши инструменты редактирования */}
  <button onClick={() => handleImageEdit(editedFile)}>
    Применить изменения
  </button>
</div>;
```

## Состояние редактирования

Режим редактирования управляется через:

- `isEditing` - флаг активного редактирования
- `editMode` - выбранный тип редактирования
- Локальное состояние в `ImageArtifactWrapper`

## Следующие шаги

1. **Замените область "ЧИСТЫЙ ХОЛСТ"** вашим функционалом
2. **Добавьте инструменты редактирования** (фильтры, кисти, слои и т.д.)
3. **Интегрируйтесь с API** загрузки файлов
4. **Добавьте предпросмотр** изменений
5. **Реализуйте сохранение** в базу данных

## Технические детали

- Компонент использует `memo` для оптимизации
- Состояние редактирования синхронизируется с артефактом
- Все изменения проходят через `updateContent`
- Поддерживается отмена изменений с возвратом к оригиналу


